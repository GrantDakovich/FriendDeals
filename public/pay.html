<html>
<body>
<script>
(function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) {
        return;
    }
    js = d.createElement(s);
    js.id = id;
    js.src = "//connect.facebook.com/en_US/messenger.Extensions.js";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'Messenger'));
window.extAsyncInit = function () {
      MessengerExtensions.getSupportedFeatures(function success(result) {
      let features = result.supported_features;
      if (features.indexOf("context") != -1) {
        MessengerExtensions.getContext('205924050770323',
          function success(thread_context) {
            // success
            alert(thread_context);
            document.getElementById("psid").value = thread_context.psid;
            document.getElementById('submitButton').addEventListener('click', function () {
                    MessengerExtensions.requestCloseBrowser(function success() {
                        console.log("Webview closing");
                    }, function error(err) {
                        console.log(err);
                    });
                });
          },
          function error(err) {
            console.log(err);
          }
        );
      }
    }, function error(err) {
      console.log(err);
    });
      alert("done");
};
</script>
<form action="/paypostback" method="get">
    <input type="hidden" name="psid" id="psid">
    Name on Card: <br>
    <input type="text" name="card_name" id="card_name"><br>
    Card Number: <br>
    <input type="text" name="card_number" id="card_number"><br>
    Exp: <br>
    <input type="text" name="expiration_date" id="expiration_date"><br>
    CVV: <br>
    <input type="text" name="cvv" id="cvv"><br>
    <input type="submit" value="Submit" id="submitButton">
</form>
</body>
</html>
